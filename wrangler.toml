name = "erudify-app"
main = ".wrangler/dist/worker/worker.js"
compatibility_date = "2024-11-23"
workers_dev = true

[build]
command = "nix build .#website -o .wrangler/dist"

[assets]
directory = ".wrangler/dist/assets"
binding = "ASSETS"
not_found_handling = "single-page-application"

# Production environment with custom domain
[env.production]
workers_dev = false
routes = [
  { pattern = "erudify.org", custom_domain = true },
  { pattern = "www.erudify.org", custom_domain = true }
]

[env.e2e]
main = "result/worker/worker.js"

[env.e2e.build]
# Don't run build command - website is pre-built by Nix
command = ""

[env.e2e.assets]
directory = "result/assets"
binding = "ASSETS"
not_found_handling = "single-page-application"
